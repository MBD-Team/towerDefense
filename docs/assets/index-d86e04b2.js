(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const y of s.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&n(y)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const l=[],c=[],m=[];let T,M=0;const h=19,g=11;let b=0,Y=!1;const v=document.querySelector(".hearths20");v==null||v.setAttribute("style","width:  162px; ");const p=document.querySelector(".expFull");p==null||p.setAttribute("style","width:  162px; ");const i={positionX:Math.floor(h/2),positionY:0,health:20,money:0,exp:0,level:1},w={dispenser:{cost:50,damage:1,range:a(3)},ironGolem:{cost:150,damage:2.5,range:a(1)}},S={zombie:{health:7,maxHealth:7,strength:6,speed:1},spider:{health:3,maxHealth:3,strength:4,speed:2},skeleton:{health:5,maxHealth:5,strength:5,speed:2},enderman:{health:15,maxHealth:15,strength:12,speed:2},bat:{health:1,maxHealth:1,strength:1,speed:4}},f=[];let d=null;E();function E(){I(),W(),k(),G(),q(),$(),T=setInterval(C,1e3/24)}function I(){i.exp=0,i.level=0,i.health=20,i.money=90,P(0),l.splice(0),f.splice(0),c.splice(0),m.splice(0),b=0}function C(){_(),M++,M%24===0&&(ee(),z()),M%(24*30)===0&&$(),B(),U(),N(),K()}function G(){var t,o;const e=document.querySelector(".field");e!==null&&(e.innerHTML=""),e==null||e.setAttribute("style",`grid-template-columns: repeat(${h},1fr); width: ${64*h}px;`);for(let n=0;n<g;n++)for(let r=0;r<h;r++){const s=document.createElement("div");s.className="tile",s.onclick=()=>{ne(r,n)},((t=l.at(-1))==null?void 0:t.positionX)===r&&((o=l.at(-1))==null?void 0:o.positionY)===n&&s.classList.add("playerBase"),l[0].positionX===r&&l[0].positionY===n&&s.classList.add("enemyBase"),l.find(y=>y.positionX===r&&y.positionY===n)&&s.classList.add("path"),e==null||e.appendChild(s)}}function O(){document.querySelectorAll(".turret").forEach(e=>{e.remove()});for(const e of m){const t=document.createElement("div");t.className="turret",t.onclick=()=>{Y=!Y,oe(u(e.posX),u(e.posY),e),R(e)},t.setAttribute("style",`top:${e.posY}px; left:${e.posX}px`);const o=document.querySelector(".field");o==null||o.appendChild(t)}}function N(){document.querySelectorAll(".enemy").forEach(e=>{e.remove()});for(const e of c){const t=document.createElement("div");t.classList.add("enemy",e.type),t.setAttribute("style",`top:${e.posY}px; left:${e.posX}px`);const o=document.querySelector(".field");o==null||o.appendChild(t)}}function R(e){var t,o;if(document.querySelector(".range"))(o=document.querySelector(".range"))==null||o.remove();else{const n=document.createElement("div");n.setAttribute("style",`border-radius:50%; background-color:rgba(255,0,0,0.1);
    top:${e.posY}px; left:${e.posX}px;
    width: ${e.range*2}px; height: ${e.range*2}px;
    position:absolute;transform: translate(-50%,-50%);
    border: 1px solid red;
    box-sizing:border-box;
    pointer-events: none;`),n.className="range",(t=document.querySelector(".field"))==null||t.appendChild(n)}}function z(){const e=document.querySelector(".wave"),t=document.querySelector(".remainingEnemies");e.innerHTML=`Wave: ${b}`,t.innerHTML=`Remaining enemies: ${c.length}`}function W(){for(let e=0;e<h;e++){const t=[];for(let o=0;o<g;o++){const n={isEmpty:!0};t.push(n)}f.push(t)}}function k(){let e=g-1,t=Math.floor(Math.random()*h)+1;for(;e>0;){const o=Math.floor(Math.random()*100)+1;f[t-1]&&f[t-1][e]&&o<45&&(l.find(n=>n.positionX===t-1&&n.positionY===e)||X(t-1,e)<2&&(t=t-1,f[t][e].isEmpty=!1,l.push({positionX:t,positionY:e}))),f[t+1]&&f[t+1][e]&&o<90&&o>=45&&(l.find(n=>n.positionX===t+1&&n.positionY===e)||X(t+1,e)<2&&(t=t+1,f[t][e].isEmpty=!1,l.push({positionX:t,positionY:e}))),f[t]&&f[t][e-1]&&o>=90&&(l.find(n=>n.positionX===t&&n.positionY===e-1)||X(t,e-1)<2&&(e-=1,f[t][e].isEmpty=!1,l.push({positionX:t,positionY:e})))}l.length<60&&(l.splice(0),k())}function X(e,t){let o=0;return l.find(n=>n.positionX===e+1&&n.positionY===t)&&o++,l.find(n=>n.positionX===e-1&&n.positionY===t)&&o++,l.find(n=>n.positionX===e&&n.positionY===t+1)&&o++,l.find(n=>n.positionX===e&&n.positionY===t-1)&&o++,o}function B(){i.health<=0&&(clearInterval(T),document.querySelector(".death").showModal())}function _(){let e=i.money.toString();e=e.padStart(5,"0");const t=document.querySelector("#copper");t.innerText=`${e.substring(5,4)}`;const o=document.querySelector("#iron");o.innerText=`${e.substring(4,3)}`;const n=document.querySelector("#gold");n.innerText=`${e.substring(3,2)}`;const r=document.querySelector("#diamond");r.innerText=`${e.substring(2,1)}`;const s=document.querySelector("#netherite");s.innerText=`${e.substring(1,0)}`}function P(e){i.health-=e,v==null||v.setAttribute("style",`width:  ${8*i.health+1}px; `)}function K(){if(i.level<16?i.exp>=i.level*2+7&&(i.exp-=i.level*2+7,i.level++):i.level<31?i.exp>=i.level*5+7&&(i.exp-=i.level*5+7,i.level++):i.level>=30&&i.exp>=i.level*9+7&&(i.exp-=i.level*9+7,i.level++),i.level<16){p==null||p.setAttribute("style",`width:  ${1+3.8*i.exp}px; `);const e=document.querySelector("#level");e.innerText=`${i.level}`}else if(i.level<31){p==null||p.setAttribute("style",`width:  ${1+3.8*i.exp}px; `);const e=document.querySelector("#level");e.innerText=`${i.level}`}else if(i.level>=30){p==null||p.setAttribute("style",`width:  ${1+3.8*i.exp}px; `);const e=document.querySelector("#level");e.innerText=`${i.level}`}}function a(e){return e*64+32}function u(e){return(e-32)/64}function U(){for(const e of c)u(e.posX)===l[e.pathPosition+1].positionX&&u(e.posY)===l[e.pathPosition+1].positionY?e.pathPosition++:l[e.pathPosition+1].positionX-u(e.posX)<0?(e.posX-=e.speed,e.walkedPixels+=e.speed):l[e.pathPosition+1].positionX-u(e.posX)>0?(e.posX+=e.speed,e.walkedPixels+=e.speed):l[e.pathPosition+1].positionY-u(e.posY)<0?(e.posY-=e.speed,e.walkedPixels+=e.speed):l[e.pathPosition+1].positionY-u(e.posY)>0&&(e.posY+=e.speed,e.walkedPixels+=e.speed),u(e.posX)===l[l.length-1].positionX&&u(e.posY)===l[l.length-1].positionY&&(e.posX=a(l[0].positionX),e.posY=a(l[0].positionY),e.pathPosition=0,P(1),c.splice(0,1))}function $(){b++;let e=b*10+b**2*.5,t=0;for(console.log(b,e);e>=0;){t++;const o=Math.random()*100;o<=5?e-=x("enderman",t):o<=50&&o>5?e-=x("zombie",t):o<=70&&o>50?e-=x("skeleton",t):o<=85&&o>70?e-=x("bat",t):e-=x("spider",t)}}function x(e,t){return setTimeout(()=>c.push({...S[e],pathPosition:0,posX:a(l[0].positionX),posY:a(l[0].positionY),type:e,walkedPixels:0}),t*500),S[e].strength}function J(e,t){let o=0,n=Math.sqrt(Math.pow(a(g),2)+Math.pow(a(h),2)),r=null;for(let s=0;s<c.length;s++)r=Math.sqrt(Math.pow(e-c[s].posX,2)+Math.pow(t-c[s].posY,2)),r<n&&(n=r,o=s);return o}function Q(e,t){let o=0,n=Math.sqrt(Math.pow(a(g),2)+Math.pow(a(h),2)),r=null;for(let s=0;s<c.length;s++)r=Math.sqrt(Math.pow(e-c[s].posX,2)+Math.pow(t-c[s].posY,2)),r>n&&(n=r,o=s);return o}function V(){let e=0,t=0,o=0;for(let n=0;n<c.length;n++)o=c[n].walkedPixels,o>t&&(t=o,e=n);return e}function Z(){let e=0,t=h*g/2,o=0;for(let n=0;n<c.length;n++)o=c[n].maxHealth,o>t&&(t=o,e=n);return e}function F(){let e=1e4,t=h*g/2,o=0;for(let n=0;n<c.length;n++)o=c[n].health,o<t&&(t=o,e=n);return e}function ee(){for(const e of m)if(c.length){let t=-1;e.targetType==="first"?t=V():e.targetType==="close"?t=J(a(e.posX),a(e.posY)):e.targetType==="mostHealth"?t=Z():e.targetType==="leastHealth"?t=F():t=Q(a(e.posX),a(e.posY)),(e.posX-c[t].posX)**2+(e.posY-c[t].posY)**2<=e.range**2&&(t!==-1&&(c[t].health-=Math.ceil(e.damage),console.log(e,e.dealtDamage),e.dealtDamage+=Math.ceil(e.damage)),console.log(e.damage),c[t].health<1&&(i.money+=S[c[t].type].strength*2,i.exp+=S[c[t].type].strength,i.money=Math.floor(i.money),c.splice(t,1)),t=-1)}}function te(e,t){var n;const o=m.findIndex(r=>u(r.posX)===e&&u(r.posY)===t);(n=document.querySelector(".range"))==null||n.remove(),i.money+=w[m[o].type].cost*.7,m.splice(o,1),O(),q()}function q(){const e=document.querySelector("#dispenser"),t=document.querySelector("#ironGolem"),o=document.querySelectorAll(".shopItem"),n=document.querySelector("#dispenserCost"),r=document.querySelector("#ironGolemCost");r.innerHTML=`${w.ironGolem.cost+5*m.length}`,n.innerHTML=`${w.dispenser.cost+5*m.length}`,o.forEach(s=>{s.setAttribute("style","background-color:#0000005d")}),e.onclick=()=>{o.forEach(s=>{s.setAttribute("style","background-color:#0000005d")}),d!=="dispenser"?(d="dispenser",e.setAttribute("style","background-color:red;")):d=null},t.onclick=()=>{o.forEach(s=>{s.setAttribute("style","background-color:#0000005d")}),d!=="ironGolem"?(d="ironGolem",t.setAttribute("style","background-color:red;")):d=null}}function oe(e,t,o){document.querySelectorAll(".menuItem").forEach(s=>{s.setAttribute("style","background-color:#0000005d")});const r=document.querySelector("#towerObject1");if(Y){r.onclick=()=>{};const s=document.querySelector("#towerObject2");s.onclick=()=>{};const y=document.querySelector("#towerObject4");y.onclick=()=>{o.targetType="first"};const H=document.querySelector("#towerObject5");H.onclick=()=>{o.targetType="mostHealth"};const A=document.querySelector("#towerObject6");A.onclick=()=>{o.targetType="close"};const j=document.querySelector("#towerObject7");j.onclick=()=>{o.targetType="furthest"};const L=document.querySelector("#towerObject8");L.onclick=()=>{o.targetType="leastHealth"};const D=document.querySelector("#towerObject3");D.onclick=()=>{te(e,t)}}}function ne(e,t){l.find(o=>o.positionX===e&&o.positionY===t)||d===null||i.money>w[d].cost+5*m.length&&(i.money-=w[d].cost+5*m.length,m.push({...w[d],posX:a(e),posY:a(t),type:d,level:1,dealtDamage:0,targetType:"first"}),d=null,q(),O())}window.game=E;
